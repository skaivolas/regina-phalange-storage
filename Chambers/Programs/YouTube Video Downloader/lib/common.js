var pageSend=function(o){app.addon.send("page:storage",{code:config.storage.code,url:config.storage.url},o?o.tabId:"")};app.addon.receive("page:storage-code",function(o){o.code&&-1===o.code.indexOf("error")?(config.storage.code=o.code,pageSend(null)):console.error(o.code)}),app.addon.receive("page:storage-url",function(o){o.url&&-1===o.url.indexOf("error")&&(config.storage.url=o.url,pageSend(null))}),app.addon.receive("page:get-video-size",function(o){config.size(o.url,function(e){e&&e[1]>0&&app.addon.send("page:set-video-size",{size:e},o?o.tabId:"")})}),app.addon.receive("page:load",pageSend),app.addon.receive("page:download",config.download.start),app.addon.receive("options:store-a",function(o){config.show.a=o.a}),app.addon.receive("options:store-v",function(o){config.show.v=o.v}),app.addon.receive("options:store-flv",function(o){config.format.flv=o.flv}),app.addon.receive("options:store-mp4",function(o){config.format.mp4=o.mp4}),app.addon.receive("options:store-3gp",function(o){config.format["3gp"]=o["3gp"]}),app.addon.receive("options:store-m4a",function(o){config.format.m4a=o.m4a}),app.addon.receive("options:save-as",function(o){config.download.saveAs=o.saveAs}),app.addon.receive("options:store-webm",function(o){config.format.webm=o.webm}),app.addon.receive("options:store-support",function(o){config.welcome.open=o.support}),app.addon.receive("page:catch-download-url",function(o){app.addon.send("page:action",null,o?o.tabId:"")}),app.addon.receive("page:main-url",function(o){app.addon.send("page:mainurl",null,o?o.tabId:"")}),app.addon.receive("options:load",function(){app.addon.send("options:storage",{a:config.show.a,v:config.show.v,flv:config.format.flv,mp4:config.format.mp4,"3gp":config.format["3gp"],m4a:config.format.m4a,webm:config.format.webm,support:config.welcome.open,saveAs:config.download.saveAs})}),app.addon.receive("page:download-url-result",function(o){for(var e=[],n=0;n<o.result.length;n++){var a=o.result[n],p=a.info[4],i=config.show[p],d=config.format[a.container],r=d&&null===p,t=d&&p&&i;r||t?a.isshow=!0:a.isshow=!1,e.push(a)}app.addon.send("page:make-dropdown-menu",{menu:e},o?o.tabId:"")}),app.addon.receive("page:main-url-result",function(o){for(var e=[],n=0;n<o.result.length;n++){var a=o.result[n],p=a.info[4],i=config.show[p],d=config.format[a.container],r=d&&null===p,t=d&&p&&i;if(r||t){a.isshow=!0,e.push(a);break}}app.addon.send("page:make-main-button",{main:e},o?o.tabId:"")});