var YouTubeToPopUp={settings:{oldUrl:"/",systemNumber:0,lastInserted:0,firstLoad:!1,inCinemaMode:!1,userSettings:{darkMode:!0,popUps:!0,cinemaMode:!0,downloadButton:!0,downloadMusicButton:!0,inDarkMode:!1},youtubeSettings:{layout:1}},init:function(){if(YouTubeToPopUp.addScripts(),YouTubeToPopUp.loadSettings(),"Error 400 (Bad Request)!!1"==document.title){for(var e=document.cookie.split(";"),t=0;t<e.length;t++)if(-1!==e[t].indexOf("video_watcher_")){var o=e[t].split("=");document.cookie=o[0]+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",console.log(o[0]+" removed")}document.location.reload()}setInterval(function(){if(null!=document.getElementById("pla-shelf")&&(YouTubeToPopUp.settings.youtubeSettings.layout=2,document.getElementsByTagName("body")[0].hasAttribute("style-theme","2")||document.getElementsByTagName("body")[0].setAttribute("style-theme","2")),YouTubeToPopUp.settings.userSettings.inDarkMode)YouTubeToPopUp.darkChecker();else if(document.getElementsByTagName("body")[0].hasAttribute("style-modus","dark")&&document.getElementsByTagName("body")[0].removeAttribute("style-modus"),null!=document.getElementById("YouTubePopupContainer_"+YouTubeToPopUp.settings.systemNumber)&&YouTubeToPopUp.hasClass(document.getElementById("YouTubePopupContainer_"+YouTubeToPopUp.settings.systemNumber),"dark")){if(1==YouTubeToPopUp.settings.inCinemaMode)return;document.getElementById("YouTubePopupContainer_"+YouTubeToPopUp.settings.systemNumber).classList.toggle("dark"),document.getElementById("YouTubePopupContainer_"+YouTubeToPopUp.settings.systemNumber).classList.toggle("light")}document.location.href!=YouTubeToPopUp.settings.oldUrl&&(YouTubeToPopUp.settings.oldUrl=document.location.href,YouTubeToPopUp.addScripts(),console.log("%c YouTube to PopUp: UPDATE! I see that there is another video!","color: #2980b9"),YouTubeToPopUp.changedPage())},500)},addScripts:function(){if(null==document.getElementById("YoutubeToPopupScript")){var e=document.createElement("script");e.setAttribute("id","YoutubeToPopupScript"),e.setAttribute("type","text/javascript"),e.setAttribute("src","chrome-extension://"+chrome.runtime.id+"/Dark/scripts/youtubeToPopUpPlayerHandler.js"),document.getElementsByTagName("head")[0].appendChild(e)}if(null==document.getElementById("YoutubeToPopupStyle")){var t=document.createElement("link");t.setAttribute("id","YoutubeToPopupStyle"),t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href","chrome-extension://"+chrome.runtime.id+"/Dark/css/YouTubeHandler.css"),document.getElementsByTagName("head")[0].appendChild(t)}},changedPage:function(){console.log("%c YouTube to PopUp: Called and found the","color: #2980b9");var e=document.location.href;if(e.indexOf("youtube.com/watch?v=")>-1){chrome.runtime.sendMessage({newIconPath:"/images/icon.png"}),console.log("%c YouTube to PopUp: This is a Youtube Video page","color: #2980b9"),YouTubeToPopUp.settings.systemNumber++,YouTubeToPopUp.loadSettings();var t=setInterval(function(){null==document.getElementById("YouTubePopupContainer_"+YouTubeToPopUp.settings.systemNumber)?YouTubeToPopUp.addButton(YouTubeToPopUp.settings.systemNumber):(clearInterval(t),1==YouTubeToPopUp.settings.userSettings.firstLoad&&YouTubeToPopUp.FirstLoad(YouTubeToPopUp.settings.systemNumber))},500)}else console.log("%c YouTube to PopUp: This is not YouTube","color: #FF0000")},addButton:function(e,t){if(t||(t=!1),YouTubeToPopUp.settings.lastInserted!=e||0!=t){YouTubeToPopUp.settings.lastInserted=e;var o="";2==YouTubeToPopUp.settings.youtubeSettings.layout&&(o+='<div id="info" class="style-scope ytd-watch">',YouTubeToPopUp.settings.userSettings.darkMode=!1,YouTubeToPopUp.settings.userSettings.cinemaMode=!1),o+='<div class="yttpu_container clearfix '+(1==YouTubeToPopUp.settings.userSettings.inDarkMode?"dark":"light")+(2==YouTubeToPopUp.settings.youtubeSettings.layout?" yttpu_themefix_2":"")+'" id="YouTubePopupContainer_'+e+'"><ul>'+(YouTubeToPopUp.settings.userSettings.darkMode?'<li><a href="javascript:void(0)" title="Dark mode" id="YouTubePopupContainer_'+e+'_darkmodus" class="yttpu_darkmode yt-uix-tooltip"><span></span></a></li>':"")+'</ul><ul class="rightbar">'+(YouTubeToPopUp.settings.userSettings.cinemaMode?'<li><a href="javascript:void(0)" title="Cinema mode" id="YouTubePopupContainer_'+e+'_cinemamode" class="yttpu_cinema yt-uix-tooltip"><span></span></a></li>':"")+'<li class="creator-bar-item"><a href="javascript:void(0)" id="YouTubePopupContainer_'+e+'_pp" title="To Popup" class="yttpu_popup yt-uix-tooltip"><span></span></a></li></ul></div>',2==YouTubeToPopUp.settings.youtubeSettings.layout&&(o+="</div>"),null!=document.getElementById("pla-shelf")?document.getElementById("pla-shelf").insertAdjacentHTML("beforebegin",o):document.getElementById("watch-header").insertAdjacentHTML("beforebegin",o),setTimeout(function(){null==document.getElementById("YouTubePopupContainer_"+e)&&YouTubeToPopUp.addButton(e,!0)},500),setTimeout(function(){clearInterval(YouTubeToPopUp_pp_click.timer),YouTubeToPopUp_pp_click.init(e),YouTubeToPopUp.settings.userSettings.cinemaMode&&null!=document.getElementById("YouTubePopupContainer_"+e+"_cinemamode")&&(document.getElementById("YouTubePopupContainer_"+e+"_cinemamode").onclick=function(){document.getElementsByTagName("body")[0].classList.toggle("yttpu_cinemaMode"),document.getElementById("YouTubePopupContainer_"+e+"_cinemamode").classList.toggle("on"),YouTubeToPopUp.settings.inCinemaMode=YouTubeToPopUp.settings.inCinemaMode?!1:!0,0==YouTubeToPopUp.settings.userSettings.inDarkMode&&document.getElementById("YouTubePopupContainer_"+e).classList.toggle("dark")}),YouTubeToPopUp.settings.userSettings.darkMode&&null!=document.getElementById("YouTubePopupContainer_"+e+"_darkmodus")&&(document.getElementById("YouTubePopupContainer_"+e+"_darkmodus").onclick=function(){YouTubeToPopUp.settings.userSettings.inDarkMode=1==YouTubeToPopUp.settings.userSettings.inDarkMode?!1:!0,chrome.storage.sync.set({inDarkMode:YouTubeToPopUp.settings.userSettings.inDarkMode});var e=document.getElementById("caption-container"),t=e.getElementsByTagName("paper-toggle-button")[0];t.checked||t.click()})},200)}},setFunction:function(e){var t=document.createElement("script");t.appendChild(document.createTextNode("("+e+")();")),(document.body||document.head||document.documentElement).appendChild(t)},loadSettings:function(){chrome.storage.sync.get({darkMode:!0,popUps:!0,cinemaMode:!0,downloadButton:!0,downloadMusicButton:!0,firstLoad:!1,inDarkMode:!1},function(e){YouTubeToPopUp.settings.userSettings.darkMode=e.darkMode,YouTubeToPopUp.settings.userSettings.popUps=e.popUps,YouTubeToPopUp.settings.userSettings.cinemaMode=e.cinemaMode,YouTubeToPopUp.settings.userSettings.downloadButton=e.downloadButton,YouTubeToPopUp.settings.userSettings.downloadMusicButton=e.downloadMusicButton,YouTubeToPopUp.settings.userSettings.firstLoad=e.firstLoad,YouTubeToPopUp.settings.userSettings.inDarkMode=e.inDarkMode}),null!=document.getElementById("YouTubePopupContainer_"+(YouTubeToPopUp.settings.systemNumber-1))&&document.getElementById("YouTubePopupContainer_"+(YouTubeToPopUp.settings.systemNumber-1)).remove()},FirstLoad:function(e){function t(){return!0}var o=!1;chrome.storage.sync.set({firstLoad:!1}),YouTubeToPopUp.setFunction("YoutubeToPopUp_pp.pauseVideo"),t(),window.onresize=function(){1!=o&&(null!=document.getElementById("yttpu-installator")&&document.getElementById("yttpu-installator").remove(),t())},document.getElementById("YouTubePopupContainer_"+e).onclick=function(){null!=document.getElementById("yttpu-installator")&&document.getElementById("yttpu-installator").remove(),o=!0,YouTubeToPopUp.saveFirstLoad()}},saveFirstLoad:function(){chrome.storage.sync.set({firstLoad:!1})},hasClass:function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},darkChecker:function(){document.getElementsByTagName("body")[0].hasAttribute("style-modus","dark")||document.getElementsByTagName("body")[0].setAttribute("style-modus","dark"),null!=document.getElementById("YouTubePopupContainer_"+YouTubeToPopUp.settings.systemNumber)&&YouTubeToPopUp.hasClass(document.getElementById("YouTubePopupContainer_"+YouTubeToPopUp.settings.systemNumber),"light")&&(document.getElementById("YouTubePopupContainer_"+YouTubeToPopUp.settings.systemNumber).classList.toggle("dark"),document.getElementById("YouTubePopupContainer_"+YouTubeToPopUp.settings.systemNumber).classList.toggle("light"))},getCookie:function(e){for(var t=e+"=",o=document.cookie.split(";"),u=0;u<o.length;u++){for(var n=o[u];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""},callMeMaybe:function(){console.log("no!")},setCookie:function(e,t,o){var u=new Date;u.setTime(u.getTime()+24*o*60*60*1e3);var n="expires="+u.toUTCString();document.cookie=e+"="+t+";"+n+";path=/"}},YouTubeToPopUp_pp_click={currentTabId:-1,timer:{},watchInterval:{},gotError:!1,init:function(e){null!=document.getElementById("YouTubePopupContainer_"+e+"_pp")&&(document.getElementById("YouTubePopupContainer_"+e+"_pp").onclick=function(){if(null!=document.getElementById("youtubeToPopUpPlayerHandlerInput")){var e=document.getElementById("youtubeToPopUpPlayerHandlerInput").value,t=document.location.href,o=/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,u=t.match(o);if(u&&11==u[2].length)var n="https://www.youtube.com/embed/"+u[2]+"?start="+e+"&autoplay=1";else if(t.indexOf("&list=")>-1)if(t.indexOf("&index=")>-1)var n=t.replace("watch?v=","embed/").replace("&index=","?index=")+"&start="+e+"&autoplay=1";else var n=t.replace("watch?v=","embed/").replace("&list=","?list=")+"&start="+e+"&autoplay=1";else if(t.indexOf("&t=")>-1)var n=t.replace("watch?v=","embed/").replace("&t=","?okay=true")+"&start="+e+"&autoplay=1";else var n=t.replace("watch?v=","embed/")+"?start="+e+"&autoplay=1";YouTubeToPopUp.setFunction("YoutubeToPopUp_pp.pauseVideo");var s=YouTubeToPopUp_pp_click.makeid();chrome.runtime.sendMessage({action:"openPopUp",url:n,videoId:s});var i=0;clearInterval(YouTubeToPopUp_pp_click.watchInterval),YouTubeToPopUp_pp_click.watchInterval=setInterval(function(){var e=YouTubeToPopUp.getCookie("video_watcher_"+s);if(e)YouTubeToPopUp.getCookie("video_watcher_gone_"+s)&&(clearInterval(YouTubeToPopUp_pp_click.watchInterval),YouTubeToPopUp.setFunction("YoutubeToPopUp_pp.setVideoTime('"+e+"')"),document.cookie="video_watcher_gone_"+s+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="video_watcher_"+s+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;");else{if(40==i){if(clearInterval(YouTubeToPopUp_pp_click.watchInterval),1==YouTubeToPopUp_pp_click.gotError)return;return void(YouTubeToPopUp_pp_click.gotError=!0)}i++}},500)}})},makeid:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;5>o;o++)e+=t.charAt(Math.floor(Math.random()*t.length));var u=Date.now()/1e3|0;return e+"-"+u.toString()},setVideoWatcher:function(e){return console.log("Hello! I am watching this video too for you now. So when you close this window I can try to start the default video player again :)"),YouTubeToPopUp.setFunction("YoutubeToPopUp_pp.setVideoWatcher('"+e+"')"),"returnTrue"}};chrome.storage.local.get({darkModes:!0},function(e){e.darkModes&&YouTubeToPopUp.init()});