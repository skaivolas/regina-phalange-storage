var browser=self.browser;"undefined"==typeof browser&&(browser=self.chrome);var floatVideo={init:function(){$(document).ready(function(){function t(){$(".mnyt-progress-wrap").height(5),$(".mnyt-progress-bar").height(5),$(".mnyt-progress-pointer").show()}function e(){$(".mnyt-progress-wrap").height(1),$(".mnyt-progress-bar").height(1),$(".mnyt-progress-pointer").hide()}function n(t){var e=t.offsetX,n=$(".mnyt-progress-area").width();"mnyt-progress-bar mnyt-progress"===t.target.className&&(e+=$(".mnyt-progress-bar").position().left);var i=e/n,o=$(et).get(0);o.currentTime=i*o.duration,c()}function i(){o(),$settingsSavedAlert=$('<div style="width: 100%">                                    <div class="alert alert-success" role="alert">                                        <img src="https://raw.githubusercontent.com/jianweichuah/miniyoutube/master/images/icon16.png" height="10px">                                        Float View: Screen settings saved!                                    </div>                                 </div>'),$("body").prepend($settingsSavedAlert),$settingsSavedAlert.show().delay(1e3).fadeOut(100,function(){$(this).remove()})}function o(){_=$(tt).position().top,L=$(tt).position().left,M=$(tt).height(),x=$(tt).width(),browser.runtime.sendMessage({update_miniscreen_positions:{miniScreenLastTop:_,miniScreenLastLeft:L,miniScreenLastHeight:M,miniScreenLastWidth:x}})}function s(){d(R,I)}function r(){d(Q,q)}function a(){d(B,E)}function u(){d(G,J)}function d(t,e){return $(tt).width()==t?!1:($(tt).animate({width:t,height:e},300),void $(et).animate({width:t,height:e},300))}function m(){$video=$(et).get(0);var t=1;switch($video.playbackRate){case 1:t=1.25;break;case 1.25:t=1.5;break;case 1.5:t=2;break;default:t=1}return $video.playbackRate=t,!1}function c(){if(0==H)return!1;if($video=$(et).get(0),1==H&&$video.currentTime==$video.duration)return z(),!1;var t=$video.currentTime/$video.duration,e=$(tt).width(),n=t*e;$(".mnyt-progress-bar").stop().animate({left:n}),$(".mnyt-progress-pointer").stop().animate({left:n-5}),$("#mnyt-progress-current-time").html(l(Math.floor($video.currentTime))),$("#mnyt-progress-duration").html()||$("#mnyt-progress-duration").html(l(Math.floor($video.duration)))}function l(t){var e=Math.floor(t/3600);t-=3600*e;var n=Math.floor(t/60),i=t-60*n,o=[];if(e>0&&o.push(e),n>0){var s=n;e>0&&10>n&&(s="0".concat(n)),o.push(s)}else o.push("0");if(i>0){var r=i;10>i&&(r="0".concat(i)),o.push(r)}else o.push("00");return o.join(":")}function p(t){return W=!0,j=t.clientX,X=t.clientY,A=$(tt).width(),Y=$(tt).height(),D=Y/A,$(window).mousemove(h),$(window).mouseup(g),t.preventDefault(),!1}function h(t){if(0==W)return!1;var e=A+t.clientX-j;V>e&&(e=V);var n=Math.round(e*D);return $(tt).width(e),$(tt).height(n),$(et).width(e),$(et).height(n),t.preventDefault(),!1}function g(t){return W=!1,$(window).unbind("mousemove"),!1}function y(){$vid=$(et).get(0),$vid.paused?($vid.play(),$(".mnyt-play-button-play").hide(),$(".mnyt-play-button-pause").show()):($vid.pause(),$(".mnyt-play-button-play").show(),$(".mnyt-play-button-pause").hide())}function v(t){var e=new Image;e.src=t}function f(t){browser.runtime.sendMessage({get_activation_status:!0},function(e){var n=!0;"is_active"in e&&(n=e.is_active),t(n)})}function b(){browser.runtime.sendMessage({get_miniscreen_positions:!0},function(t){if("positions"in t){var e=t.positions;e[K]&&(_=e[K]),e[P]&&(L=e[P]),e[U]&&(M=e[U]),e[Z]&&(x=e[Z])}})}function w(t){O=t,!O&&H&&z()}function S(){$video=$(et),$video.next().remove(),$video.removeClass("mnyt-video"),$video.unwrap(),H=!1}function z(){$video=$(et);var t=$video.get(0).paused;o(),$(tt).appendTo(".html5-video-container"),$video.css("width",T),$video.css("height",N),$video.next().remove(),$video.removeClass("mnyt-video"),$video.unwrap(),t||$video.get(0).play(),H=!1}function k(){z(),H=!1,browser.runtime.sendMessage({update_icon:!1})}var N,T,_,L,M,x,C,j,X,A,Y,D,H=!1,V=310,W=!1,F=!1,O=!0,R=310,I=175,Q=475,q=268,B=640,E=360,G=854,J=480,K="miniScreenLastTop",P="miniScreenLastLeft",U="miniScreenLastHeight",Z="miniScreenLastWidth",tt="#miniyoutube",et=".video-stream";v("https://raw.githubusercontent.com/jianweichuah/miniyoutube/master/images/pin.png"),v("https://raw.githubusercontent.com/jianweichuah/miniyoutube/master/images/brCorner.png"),b(),f(w),browser.runtime.onMessage.addListener(function(t,e,n){"update_activation_status"in t&&w(t.update_activation_status)}),function(t){t.fn.drags=function(e){if(e=t.extend({handle:"",cursor:"move"},e),""===e.handle)var n=this;else var n=this.find(e.handle);return n.css("cursor",e.cursor).on("mousedown",function(e){if("resizer"===e.target.className||"mnyt-size-button"===e.target.className||"mnyt-pin-img"===e.target.className||"mnyt-progress-area"===e.target.className||"mnyt-play-button"===e.target.className||"mnyt-play-button-play"===e.target.className||"mnyt-play-button-pause"===e.target.className||"mnyt-progress-area"===e.target.className||"mnyt-progress-bar mnyt-progress"===e.target.className||"mnyt-progress-wrap mnyt-progress"===e.target.className||"mnyt-progress-pointer"===e.target.className)return!1;var n=t(this).addClass("draggable"),i=n.css("z-index"),o=n.outerHeight(),s=n.outerWidth(),r=n.offset().top+o-e.pageY,a=n.offset().left+s-e.pageX;n.css("z-index",1e3),t(window).on("mousemove",function(e){var n=e.pageX+a-s;5>n?n=5:n>t(window).width()-s-5&&(n=t(window).width()-s-5);var u=e.pageY+r-o;u<t(document).scrollTop()+55?u=t(document).scrollTop()+55:u>t(document).scrollTop()+t(window).height()-o-5&&(u=t(document).scrollTop()+t(window).height()-o-5),t(".draggable").offset({top:u,left:n}).on("mouseup",function(){t(this).removeClass("draggable").css("z-index",i)})}).on("mouseup",function(){t(window).unbind("mousemove"),t(this).removeClass("draggable")}),e.preventDefault()})}}(jQuery),$(window).scroll(function(){if(O){if($("#movie_player").length&&$("#movie_player").is("embed"))return F||($flashNotSupportedAlert=$('<div style="width: 100%">                                                    <div class="alert alert-danger" role="alert">                                                        <img src="https://raw.githubusercontent.com/jianweichuah/miniyoutube/master/icon16.png" height="10px">                                                        Mini YouTube: Flash videos not currently supported!                                                    </div>                                                 </div>'),$("body").prepend($flashNotSupportedAlert),$flashNotSupportedAlert.show().delay(5e3).fadeOut(300,function(){$(this).remove()}),F=!0),!1;if(0==H&&$(".ended-mode").length)return!1;if($("#player").length&&$("#player").hasClass("off-screen")){if(0==H)return!1;S()}else if(0==H&&$(document).scrollTop()>$(".html5-video-container").offset().top+$(".video-stream").height()){$miniScreen=$('<div id="miniyoutube"></div');var o=55,d=175,l=$(window).width()-380,h=310;_&&M&&L&&x&&L+x<=$(window).width()&&_+M<=$(window).height()&&(o=_,d=M,l=L,h=x),$miniScreen.css("top",o),$miniScreen.css("left",l),$miniScreen.height(d),$miniScreen.width(h),$video=$(et),$video.addClass("mnyt-video"),$video.bind("timeupdate",c);var v=$video.get(0).paused;T=$video.width(),N=$video.height(),$video.wrap($miniScreen),$(tt).appendTo("body"),$(tt).append('<div class="mnyt-controls">                                                <div class="resizer" id="mnyt-br"></div>                                                <img class="resize-icon" src="https://raw.githubusercontent.com/jianweichuah/miniyoutube/master/images/brCorner.png" />                                                <div class="mnyt-control-icons">                                                    <button class="mnyt-size-button" id="mnyt-pin-button"><img class="mnyt-pin-img" src="https://raw.githubusercontent.com/jianweichuah/miniyoutube/master/images/pin.png" width="20px"/></button>                                                    <label class="mnyt-pin-label">Save screen settings.</label>                                                    <button class="mnyt-size-button" id="mnyt-small-button">S</button>                                                    <button class="mnyt-size-button" id="mnyt-medium-button">M</button>                                                    <button class="mnyt-size-button" id="mnyt-large-button">L</button>                                                    <button class="mnyt-size-button" id="mnyt-extra-large-button">XL</button>                                                </div>                                                <div class="mnyt-play-button" id="mnyt-play-button">                                                    <div class="mnyt-play-button-play"></div>                                                    <div class="mnyt-play-button-pause"></div>                                                </div>                                                <button class="mnyt-size-button" id="mnyt-close-button">X</button>                                                <div class="mnyt-progress-time" id="mnyt-progress-time">                                                    <span id="mnyt-progress-current-time"></span>                                                    /                                                    <span id="mnyt-progress-duration"></span>                                                </div>                                                <div class="mnyt-progress-area">                                                    <div class="mnyt-progress-wrap mnyt-progress">                                                        <div class="mnyt-progress-bar mnyt-progress"></div>                                                    </div>                                                </div>                                                <div class="mnyt-progress-pointer"></div>                                          </div>'),$(tt).on("mouseover",function(t){$(".mnyt-control-icons").show(),$(".mnyt-play-button").show(),$("#mnyt-close-button").hide(),$("#mnyt-progress-time").show()}),$(tt).on("mouseleave",function(t){C=0,$(".mnyt-control-icons").hide(),$(".mnyt-play-button").hide(),$("#mnyt-close-button").hide(),$("#mnyt-progress-time").hide()}),$(tt).on("mouseup",function(t){return 1==W&&g(t),!1}),$(tt).click(function(){return!1}),$(tt).dblclick(function(){return!1}),v?$(".mnyt-play-button-play").show():($video.get(0).play(),$(".mnyt-play-button-pause").show()),$video.css("width",h),$video.css("height",d),$(tt).drags(),H=!0,$("#mnyt-small-button").click(s),$("#mnyt-medium-button").click(r),$("#mnyt-large-button").click(a),$("#mnyt-extra-large-button").click(u),$("#mnyt-play-button").click(y),$("#mnyt-pin-button").click(i),$("#mnyt-close-button").click(k),$("#mnyt-pin-button").on("mouseover",function(t){$(".mnyt-pin-label").show()}),$("#mnyt-pin-button").on("mouseleave",function(t){$(".mnyt-pin-label").hide()}),$(".mnyt-fastforward-icon").click(m),$(".resizer").bind("mousedown.resizer",p),$(".resize-icon").bind("mousedown.resizer",p),$(".mnyt-progress-area").hover(t,e),$(".mnyt-progress-area").click(n)}else 1==H&&$(document).scrollTop()<=$(".html5-video-container").offset().top+N&&z()}})})}},float;chrome.runtime.sendMessage({greeting:"proto"},function(t){var e=t.farewell;float=e["float"],float&&floatVideo.init()});